# The embedded Python script and triple-quoted string have been removed.
# Please ensure only valid YAML and shell commands are present in this workflow file.

on:
  workflow_dispatch:
    inputs:
      week:
        description: 'Week number (optional)'
        required: false
        default: 'auto'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 5) Verify outputs
      - name: Verify outputs
        run: |
          echo "=== Generated Files ==="
          find recaps -type f \( -name "*.docx" -o -name "*.pdf" \) | while read file; do
            size=$(du -h "$file" | cut -f1)
            echo "  üìÑ $file ($size)"
          done
          
          # Count files
          DOCX_COUNT=$(find recaps -name "*.docx" | wc -l)
          PDF_COUNT=$(find recaps -name "*.pdf" | wc -l)
          
          echo "Summary: $DOCX_COUNT DOCX, $PDF_COUNT PDF files created"
          
          if [ $DOCX_COUNT -eq 0 ]; then
            echo "‚ùå No DOCX files created!"
            exit 1
          fi

      # 6) Upload artifacts
      - name: Upload gazette artifacts
        uses: actions/upload-artifact@v4
        with:
          name: gazette-week-${{ github.event.inputs.week || 'auto' }}
          path: |
            recaps/**/*.docx
            recaps/**/*.pdf
          retention-days: 90
          if-no-files-found: error

      # 7) Optional: Create release (if tagged)
      - name: Create GitHub Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: |
            recaps/**/*.docx
            recaps/**/*.pdf
          generate_release_notes: true